<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Flow - M1: Planning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* --- Enterprise Theme Palette (Slate/Purple) --- */
            --bg-app: #f1f5f9;       /* Slate 100 */
            --bg-card: #ffffff;      /* White */
            --text-primary: #0f172a; /* Slate 900 */
            --text-secondary: #475569; /* Slate 600 */
            --border-light: #e2e8f0;
            --border-strong: #cbd5e1;
            
            /* Navigation Colors */
            --nav-bg: #1e293b;       /* Slate 800 */
            --nav-text: #f8fafc;     /* Slate 50 */
            --nav-active: #3b82f6;   /* Blue 500 */

            /* Module Identity (Planning = Purple) */
            --module-accent: #9333ea; /* Purple 600 */
            --module-light: #f3e8ff;  /* Purple 100 */
            
            /* Flowchart Node Color Mapping */
            --node-doc: #9333ea;      /* Purple (Document) */
            --bg-doc: #faf5ff;
            --node-event: #d97706;    /* Amber (Event/Calc) */
            --bg-event: #fffbeb;
            --node-staging: #15803d;  /* Green (Staging) */
            --bg-staging: #f0fdf4;

            --radius: 8px;
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', Inter, system-ui, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            padding-bottom: 80px;
        }

        /* --- Navigation --- */
        .nav-bar {
            background-color: var(--nav-bg);
            padding: 0 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: sticky; top: 0; z-index: 100;
        }
        .nav-container {
            max-width: 1400px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
            height: 60px;
        }
        .nav-brand { font-weight: 700; color: white; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .nav-links { display: flex; gap: 5px; }
        .nav-link {
            text-decoration: none; color: #94a3b8; font-weight: 500; font-size: 0.9rem;
            padding: 8px 12px; border-radius: 4px; transition: all 0.2s;
        }
        .nav-link:hover { color: white; background: rgba(255,255,255,0.1); }
        .nav-link.active { background: var(--nav-active); color: white; }

        /* --- Header --- */
        .header-section {
            background: white; border-bottom: 1px solid var(--border-light);
            padding: 40px 20px; text-align: center; margin-bottom: 40px;
        }
        .header-content { max-width: 1200px; margin: 0 auto; }
        .module-badge {
            background: var(--module-light); color: var(--module-accent);
            padding: 6px 16px; border-radius: 20px; font-weight: 700; font-size: 0.85rem;
            text-transform: uppercase; letter-spacing: 0.05em; display: inline-block; margin-bottom: 15px;
        }
        h1 { font-size: 2.2rem; font-weight: 800; color: var(--text-primary); margin-bottom: 10px; }
        .header-desc { color: var(--text-secondary); max-width: 800px; margin: 0 auto; line-height: 1.6; }

        /* --- Layout --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        
        /* --- Node Cards --- */
        .step-card {
            background: var(--bg-card); border-radius: var(--radius);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-card);
            display: flex; flex-direction: column; overflow: hidden;
            margin-bottom: 30px;
        }

        /* Node Styles based on Flowchart */
        .node-doc { border-top: 5px solid var(--node-doc); } 
        .node-doc .card-header { background: var(--bg-doc); color: var(--node-doc); }
        
        .node-event { border-top: 5px solid var(--node-event); }
        .node-event .card-header { background: var(--bg-event); color: var(--node-event); }
        
        .node-staging { border-top: 5px solid var(--node-staging); }
        .node-staging .card-header { background: var(--bg-staging); color: var(--node-staging); }

        .node-draft { border-top: 5px dashed var(--node-doc); }
        .node-draft .card-header { background: #ffffff; color: var(--text-secondary); border-bottom: 1px dashed var(--border-light); }

        .card-header {
            padding: 15px 20px; border-bottom: 1px solid var(--border-light);
            display: flex; justify-content: space-between; align-items: center;
        }
        .card-title { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .card-body { padding: 20px; }
        .card-desc { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6; }

        /* --- Detail List (for Step 3) --- */
        .detail-box {
            background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid var(--border-light);
        }
        .detail-item { display: flex; margin-bottom: 10px; align-items: flex-start; font-size: 0.9rem; }
        .detail-item:last-child { margin-bottom: 0; }
        .detail-icon { width: 25px; margin-right: 10px; text-align: center; }
        .detail-label { font-weight: 700; color: var(--text-primary); margin-right: 5px; min-width: 60px; }
        .detail-val { color: var(--text-secondary); }

        /* --- Data Tables --- */
        .table-wrapper { border: 1px solid var(--border-strong); border-radius: 6px; overflow: hidden; max-height: 350px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th {
            background: #e2e8f0; color: var(--text-primary); font-weight: 700;
            padding: 10px 12px; text-align: left; border-bottom: 2px solid var(--border-strong);
            position: sticky; top: 0; z-index: 10; white-space: nowrap;
        }
        td { padding: 8px 12px; border-bottom: 1px solid var(--border-light); color: #334155; white-space: nowrap; }
        tr:nth-child(even) { background: #f8fafc; }
        tr:hover { background: #f0f9ff; }

        /* --- Flow Connectors --- */
        .flow-arrow { text-align: center; margin: -15px 0 25px; position: relative; z-index: 1; }
        .flow-tag {
            background: white; color: var(--text-secondary); padding: 4px 12px; border-radius: 12px;
            font-size: 0.75rem; font-weight: 600; display: inline-block;
            border: 1px solid var(--border-strong); box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .flow-line { height: 15px; width: 2px; background: var(--border-strong); margin: 0 auto; }
        
        /* --- Badges --- */
        .pk { background: #fee2e2; color: #991b1b; padding: 1px 4px; border-radius: 3px; font-size: 0.7em; margin-left: 4px; border: 1px solid #fca5a5; }
        .fk { background: #dbeafe; color: #1e40af; padding: 1px 4px; border-radius: 3px; font-size: 0.7em; margin-left: 4px; border: 1px solid #93c5fd; }

        .badge { padding: 3px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; display: inline-block; }
        .badge-h { background: #e0e7ff; color: #3730a3; border: 1px solid #a5b4fc; }
        .badge-a { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
        .badge-ok { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .badge-draft { background: #f1f5f9; color: #475569; border: 1px dashed #cbd5e1; }
        .badge-human { background: #fffbeb; color: #d97706; border: 1px solid #fcd34d; }

        .row-count { text-align: right; font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px; font-style: italic; }

        /* --- Footer Logic --- */
        .logic-footer { margin-top: 40px; background: white; border: 1px solid var(--border-light); border-radius: var(--radius); padding: 25px; }
        .logic-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 15px; }
        .logic-item h4 { color: var(--module-accent); margin-bottom: 8px; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; }
        .logic-item p { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }

        /* --- Nav Footer --- */
        .page-footer {
            max-width: 1400px; margin: 20px auto; padding: 20px;
            background: white; border-radius: var(--radius); border: 1px solid var(--border-light);
            display: flex; justify-content: space-between; align-items: center;
        }
        .footer-btn { text-decoration: none; padding: 12px 24px; border-radius: 6px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .btn-prev { background: var(--bg-app); color: var(--text-secondary); }
        .btn-next { background: var(--nav-active); color: white; }

    </style>
</head>
<body>

    <nav class="nav-bar">
        <div class="nav-container">
            <div class="nav-brand"><i class="fas fa-cubes"></i> ISC Supply Chain</div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="module1.html" class="nav-link active">M1: Planning</a>
                <a href="module2.html" class="nav-link">M2: Procurement</a>
                <a href="module3.html" class="nav-link">M3: Balancing</a>
                <a href="module4.html" class="nav-link">M4: Inbound</a>
                <a href="module5.html" class="nav-link">M5: Inventory</a>
                <a href="module6.html" class="nav-link">M6: Control</a>
                <a href="module7.html" class="nav-link">M7: Finance</a>
            </div>
        </div>
    </nav>

    <section class="header-section">
        <div class="header-content">
            <span class="module-badge">Module 1</span>
            <h1><i class="fas fa-calendar-alt"></i> Planning & Demand</h1>
            <p class="header-desc">
                The entry point of the P2P cycle. This module converts <code>Production_Orders</code> into a specific list of <code>Material_Demand</code>.
                Crucially, it handles the <strong>Technical Selection</strong> of components via the "Transformation Pattern."
            </p>
        </div>
    </section>

    <div class="container">

        <div class="step-card node-doc">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-industry"></i> 1. Production_Order (Header)</div>
                <span class="badge badge-h">[H] History</span>
            </div>
            <div class="card-body">
                <p class="card-desc">Source document from Production Planning. Contains the `REQ_DATE` derived from the `WORK_IN_PROCESS_START_DATE`.</p>
                <div class="table-wrapper"><table id="table-production-order"></table></div>
                <div class="row-count" id="rc-production-order">...</div>
            </div>
        </div>

        <div class="flow-arrow"><div class="flow-line"></div><div class="flow-tag">Contains (1:N)</div><div class="flow-line"></div></div>

        <div class="step-card node-draft">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-file-dashed"></i> 2. Bom_Order_List_Draft</div>
                <span class="badge badge-draft">Draft</span>
            </div>
            <div class="card-body">
                <p class="card-desc">System-generated "Bill of Materials" explosion. Lists generic components, waiting for specific version selection.</p>
                <div class="table-wrapper"><table id="table-bom-draft"></table></div>
                <div class="row-count" id="rc-bom-draft">...</div>
            </div>
        </div>

        <div class="flow-arrow"><div class="flow-line"></div><div class="flow-tag">Input for Download (1:1)</div><div class="flow-line"></div></div>

        <div class="step-card node-event">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-user-pen"></i> 3. Select_BOM_Update (Offline Excel)</div>
                <span class="badge badge-human">Human Task</span>
            </div>
            <div class="card-body">
                <p class="card-desc">This is an offline business event. The Planner downloads the "Draft" list, consults the master component data, and selects the <em>exact</em> component version (<code>BOM_UPDATE</code>) to be used (e.g., <code>300010406C</code>).</p>
                
                <div class="detail-box">
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-download" style="color:var(--module-accent)"></i></div>
                        <div class="detail-label">Input:</div>
                        <div class="detail-val"><code>Bom_Order_List_Draft</code> (BOM Request)</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-book" style="color:#3b82f6"></i></div>
                        <div class="detail-label">Refs:</div>
                        <div class="detail-val"><code>Bom_Data</code> (Master Component List)</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-user" style="color:#d97706"></i></div>
                        <div class="detail-label">User:</div>
                        <div class="detail-val">Chooses the exact <code>BOM_UPDATE</code> code.</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-icon"><i class="fas fa-upload" style="color:#15803d"></i></div>
                        <div class="detail-label">Output:</div>
                        <div class="detail-val">Enriched file with <code>BOM_UPDATE</code> selected.</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flow-arrow"><div class="flow-line"></div><div class="flow-tag">Generates Upload (1:1)</div><div class="flow-line"></div></div>

        <div class="step-card node-staging">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-database"></i> 4. Bom_Order_List_Staging</div>
                <span class="badge badge-ok">Validation Active</span>
            </div>
            <div class="card-body">
                <p class="card-desc">The enriched file is uploaded. The system validates that the selected `BOM_UPDATE` exists in Master Data.</p>
                <div class="table-wrapper"><table id="table-bom-staging"></table></div>
                <div class="row-count" id="rc-bom-staging">...</div>
            </div>
        </div>

        <div class="flow-arrow"><div class="flow-line"></div><div class="flow-tag">Approved (1:1)</div><div class="flow-line"></div></div>

        <div class="step-card node-doc">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-file-contract"></i> 5. Bom_Order_List_Final</div>
                <span class="badge badge-h">[H] History</span>
            </div>
            <div class="card-body">
                <p class="card-desc">The finalized technical requirement. Immutable and auditable.</p>
                <div class="table-wrapper"><table id="table-bom-final"></table></div>
                <div class="row-count" id="rc-bom-final">...</div>
            </div>
        </div>

        <div class="flow-arrow"><div class="flow-line"></div><div class="flow-tag">Calculates (1:N)</div><div class="flow-line"></div></div>

        <div class="step-card node-event">
            <div class="card-header">
                <div class="card-title"><i class="fas fa-calculator"></i> 6. Material_Demand (Gross)</div>
                <span class="badge badge-a">[A] Aggregated</span>
            </div>
            <div class="card-body">
                <p class="card-desc">The system calculates total quantity needed: <code>ORDER_QTY * BOM_CONSUMPTION</code>. This list is fed to M3.</p>
                <div class="table-wrapper"><table id="table-demand-gross"></table></div>
                <div class="row-count" id="rc-demand-gross">...</div>
            </div>
        </div>

        <div class="logic-footer">
            <h3 style="margin-bottom: 15px; color:var(--text-primary);"><i class="fas fa-book"></i> Logic & Data Definitions</h3>
            <div class="logic-grid">
                <div class="logic-item">
                    <h4><i class="fas fa-exchange-alt"></i> The Transformation Pattern</h4>
                    <p>We use a <strong>Draft &rarr; Offline Work &rarr; Staging &rarr; Final</strong> flow. This allows humans to enrich data (selecting specific BOM versions) without directly editing the database.</p>
                </div>
                <div class="logic-item">
                    <h4><i class="fas fa-calculator"></i> Demand Calculation</h4>
                    <p>Gross Demand is purely mathematical: <code>(Prod_Order_Qty × Bom_Consumption) * (1 + Scrap_Rate)</code>. It does not account for stock on hand (that's M3's job).</p>
                </div>
            </div>
        </div>

    </div>

    <footer class="page-footer">
        <a href="index.html" class="footer-btn btn-prev"><i class="fas fa-home"></i> Home</a>
        <div style="color: var(--text-secondary); font-size: 0.9rem;">ISC Data Engineering • v15.5 Simulation</div>
        <a href="module2.html" class="footer-btn btn-next">Next: M2 Procurement <i class="fas fa-arrow-right"></i></a>
    </footer>

    <script>
        // --- DATASETS ---
        const tsvData = {
            productionOrder: `
PROD_ORDER_ID	VPO	SKU_CODE	QTY	START_DATE	STATUS
7269	V2509028C01	110132020	2502	13-Dec-2025	In progress
7270	V2509028C02	110132031	3348	16-Dec-2025	In progress
7271	V2509028C03	110067293	4500	13-Dec-2025	In progress
7272	V2509028C04	110067260	4500	14-Dec-2025	In progress
7273	V2509029C01	110067261	5000	17-Dec-2025	In progress
7274	V2509029C02	110067262	10000	18-Dec-2025	In progress
7275	V2509030C01	110132031	3500	19-Dec-2025	In progress
7276	V2509031C01	110067261	5000	20-Dec-2025	In progress
            `,
            bomDraft: `
PROD_ORDER_ID	VPO	BOM_GENERIC	CONSUMPTION	DRAFT_STATUS
7269	V2509028C01	300010406	1	Pending
7269	V2509028C01	20001816	0.027	Pending
7270	V2509028C02	300010406	2	Pending
7271	V2509028C03	300010406	3	Pending
7272	V2509028C04	300010406	3	Pending
7272	V2509028C04	40001000A	1	Pending
7273	V2509029C01	300010406	3	Pending
7273	V2509029C01	40001000A	1	Pending
7274	V2509029C02	300010406	2.5	Pending
7275	V2509030C01	300010406	2	Pending
7276	V2509031C01	300010406	3	Pending
7276	V2509031C01	40001000A	1	Pending
            `,
            bomStaging: `
PROD_ORDER_ID	VPO	BOM_UPDATE	VALIDATION
7269	V2509028C01	300010406C	✅ Valid
7269	V2509028C01	20001816	✅ Valid
7270	V2509028C02	300010406C	✅ Valid
7271	V2509028C03	300010406C	✅ Valid
7272	V2509028C04	300010406C	✅ Valid
7272	V2509028C04	40001000A	✅ Valid
7273	V2509029C01	300010406C	✅ Valid
7273	V2509029C01	40001000A	✅ Valid
7274	V2509029C02	300010406C	✅ Valid
7275	V2509030C01	300010406C	✅ Valid
7276	V2509031C01	300010406C	✅ Valid
7276	V2509031C01	40001000A	✅ Valid
            `,
            bomFinal: `
PROD_ORDER_ID	VPO	BOM_UPDATE	STATUS
7269	V2509028C01	300010406C	Approved
7269	V2509028C01	20001816	Approved
7270	V2509028C02	300010406C	Approved
7271	V2509028C03	300010406C	Approved
7272	V2509028C04	300010406C	Approved
7272	V2509028C04	40001000A	Approved
7273	V2509029C01	300010406C	Approved
7273	V2509029C01	40001000A	Approved
7274	V2509029C02	300010406C	Approved
7275	V2509030C01	300010406C	Approved
7276	V2509031C01	300010406C	Approved
7276	V2509031C01	40001000A	Approved
            `,
            demandGross: `
PROD_ORDER_ID	VPO	BOM_UPDATE	PO_QTY	CONS.	GROSS_DEMAND	REQ_DATE
7271	V2509028C03	300010406C	4500	3.0	14040.00	13-Dec
7269	V2509028C01	300010406C	2502	1.0	2602.08	13-Dec
7269	V2509028C01	20001816	2502	0.027	72.42	13-Dec
7272	V2509028C04	300010406C	4500	3.0	14040.00	14-Dec
7272	V2509028C04	40001000A	4500	1.0	4590.00	14-Dec
7270	V2509028C02	300010406C	3348	2.0	7067.84	16-Dec
7273	V2509029C01	300010406C	5000	3.0	15600.00	17-Dec
7273	V2509029C01	40001000A	5000	1.0	5100.00	17-Dec
7274	V2509029C02	300010406C	10000	2.5	26000.00	18-Dec
7275	V2509030C01	300010406C	3500	2.0	7280.00	19-Dec
7276	V2509031C01	300010406C	5000	3.0	15600.00	20-Dec
7276	V2509031C01	40001000A	5000	1.0	5100.00	20-Dec
            `
        };

        // --- RENDER LOGIC ---
        function renderTable(tableId, tsvString, headers, keyConfig) {
            const tableEl = document.getElementById(tableId);
            const lines = tsvString.trim().split('\n');
            const data = lines.slice(1).map(line => {
                const vals = line.split('\t').map(v => v.trim());
                let obj = {};
                headers.forEach((h, i) => obj[h] = vals[i] || '');
                return obj;
            });

            let thead = '<thead><tr>';
            headers.forEach(h => {
                let badge = '';
                if (keyConfig.pk && keyConfig.pk.includes(h)) badge = '<span class="pk">PK</span>';
                if (keyConfig.fk && keyConfig.fk.includes(h)) badge = '<span class="fk">FK</span>';
                thead += `<th>${h.replace(/_/g, ' ')} ${badge}</th>`;
            });
            thead += '</tr></thead>';

            let tbody = '<tbody>';
            data.forEach(row => {
                tbody += '<tr>';
                headers.forEach(h => tbody += `<td>${row[h]}</td>`);
                tbody += '</tr>';
            });
            tbody += '</tbody>';

            tableEl.innerHTML = thead + tbody;
            document.getElementById(tableId.replace('table', 'rc')).innerText = `Showing ${data.length} records`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderTable('table-production-order', tsvData.productionOrder, 
                ['PROD_ORDER_ID', 'VPO', 'SKU_CODE', 'QTY', 'START_DATE', 'STATUS'], 
                { pk: ['PROD_ORDER_ID'], fk: ['VPO'] });

            renderTable('table-bom-draft', tsvData.bomDraft,
                ['PROD_ORDER_ID', 'VPO', 'BOM_GENERIC', 'CONSUMPTION', 'DRAFT_STATUS'],
                { pk: ['PROD_ORDER_ID', 'BOM_GENERIC'], fk: ['VPO'] });

            renderTable('table-bom-staging', tsvData.bomStaging,
                ['PROD_ORDER_ID', 'VPO', 'BOM_UPDATE', 'VALIDATION'],
                { pk: ['PROD_ORDER_ID', 'BOM_UPDATE'], fk: ['VPO'] });

            renderTable('table-bom-final', tsvData.bomFinal,
                ['PROD_ORDER_ID', 'VPO', 'BOM_UPDATE', 'STATUS'],
                { pk: ['PROD_ORDER_ID', 'BOM_UPDATE'], fk: ['VPO'] });

            renderTable('table-demand-gross', tsvData.demandGross,
                ['PROD_ORDER_ID', 'VPO', 'BOM_UPDATE', 'PO_QTY', 'CONS.', 'GROSS_DEMAND', 'REQ_DATE'],
                { pk: ['PROD_ORDER_ID', 'BOM_UPDATE'], fk: ['VPO'] });
        });
    </script>
</body>
</html>
